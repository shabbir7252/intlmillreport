
@{
    ViewBag.Title = "SyncSalesData";
}

<h2>Page is for Syncing Sales Data with new transactions tables</h2>



@section scripts {
    <script>

        //SyncAllSalesReport();
        //const interval = setInterval(function () {
        //    SyncAllSalesReport()
        //}, 600000);

        function SyncAllSalesReport() {
            var daysCount = 13;
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSalesSync", "SalesReport")',
                data: { days: daysCount },
                success: function (response) {
                    console.log("");
                    console.log("Sales : ", response);
                    SyncAllSalesDetailReport(daysCount);
                },
                error: function (ex) {
                    console.log("Sales : ", ex);
                }

            });
        }

        function SyncAllSalesDetailReport(daysCount) {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSalesDetailSync", "SalesReport")',
                data: { days : daysCount },
                success: function (response) {
                    console.log("Sales Detail : ", response);
                },
                error: function (ex) {
                    console.log("Sales Detail : ", ex);
                }

            });
        }


        // for 2019 data
        var date = new Date(2020, 9, 16);
        var endDate = new Date(2020, 9, 16);
        Date.prototype.addDays = function (days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() + days);
            return date;
        };

        //SyncSalesMonth2019Report();
        //const interval = setInterval(function () {
        //    SyncSalesMonth2019Report();
        //}, 600000);

        function SyncSalesMonth2019Report() {
            var year = 2019;
            var month = date.getMonth();
            var from = date.getDate();
            var to = date.addDays(2).getDate();
            if (date > endDate) {
                console.log("2019 Ended!");
            } else {
                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GetSalesMonthSync", "SalesReport")',
                    data: {
                        year: year,
                        month: month,
                        from: from,
                        to: to
                    },
                    success: function (response) {
                        console.log("Sales Month: ", response);
                        SyncSalesDetailMonth2019Report(year, month, from, to);
                    },
                    error: function (ex) {
                        console.log("Sales Month: ", ex);
                    }
                });
            }
        }

        function SyncSalesDetailMonth2019Report(year, month, from, to) {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSalesDetailMonthSync", "SalesReport")',
                data: {
                    year: year,
                    month: month,
                    from: from,
                    to: to
                },
                success: function (response) {
                    console.log("Sales Detail Month: ", response);
                    date = date.addDays(3);
                },
                error: function (ex) {
                    console.log("Sales Detail Month: ", ex);
                }

            });
        }


        // ****************** Month Sales Data Sync (Manual) ***************** //

        SyncSalesMonthReport();

        function SyncSalesMonthReport() {
            console.log("Have Started!");
            var month = 12;
            var year = 2020;
            var from = 31;
            var to = 31;

            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSalesMonthSync", "SalesReport")',
                data: {
                    year: year,
                    month: month,
                    from: from,
                    to: to
                },
                success: function (response) {
                    console.log("Sales Month: ", response);
                    SyncSalesDetailMonthReport(year, month, from, to);
                },
                error: function (ex) {
                    console.log("Sales Month: ", ex);
                }

            });
        }

        function SyncSalesDetailMonthReport(year, month, from, to) {
            console.log("Have Started Details!");
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetSalesDetailMonthSync", "SalesReport")',
                data: {
                    year: year,
                    month: month,
                    from: from,
                    to: to
                },
                success: function (response) {
                    console.log("Sales Detail Month: ", response);
                },
                error: function (ex) {
                    console.log("Sales Detail Month: ", ex);
                }

            });
        }

        // ****************** Month Sales Data Sync (Manual) End ***************** //




        // ****************** Time Attendance Sync ***************** //

        var taFromDate = new Date(2020, 9, 16);
        var taEndDate = new Date(2020, 9, 16);

        //SyncTAReport();
        //const interval = setInterval(function () {
        //    SyncTAReport();
        //}, 600000);


        function SyncTAReport() {
            var year = taFromDate.getFullYear();
            var month = taFromDate.getMonth();
            var from = taFromDate.getDate();

            var toYear = taEndDate.getFullYear();
            var toMonth = taEndDate.getMonth();
            var to = taEndDate.getDate();

            if (taFromDate > taEndDate) {
                console.log("TA Ended!");
            } else {

                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GetTASync", "TAReport")',
                    data: {
                        year: year,
                        month: month,
                        from: from,
                        to: to,
                        toMonth: toMonth,
                        toYear: toYear
                    },
                    success: function (response) {
                        console.log("TA: ", response);
                    },
                    error: function (ex) {
                        console.log("TA: ", ex);
                    }
                });

            }
        }

        // ****************** Time Attendance Sync End ***************** //

        // ****************** Sending Mail For Time Attendance ***************** //

        EmailTAReport();
        const emailInterval = setInterval(function () {
            EmailTAReport();
        }, 30000);

        function EmailTAReport() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("SendShiftStartEmail", "TAReport")',
                success: function (response) {
                    console.log("TA Email : ", response);
                },
                error: function (ex) {
                    console.log("TA Email: ", ex);
                }
            });
        }

        EmailTAEndReport();
        const emailEndInterval = setInterval(function () {
            EmailTAEndReport()
        }, 40000);

        function EmailTAEndReport() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("SendShiftEndEmail", "TAReport")',
                success: function (response) {
                    console.log("TA End Email : ", response);
                },
                error: function (ex) {
                    console.log("TA End Email: ", ex);
                }
            });
        }

        // ****************** Sending Mail For Time Attendance End ***************** //


    </script>
}